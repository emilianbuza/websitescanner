<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Verlieren Sie t√§glich Geld durch kaputtes Tracking? | Website Scanner</title>
<style>
  :root {
    /* Base Colors */
    --bg: #ffffff;
    --bg-secondary: #f8fafc;
    --bg-tertiary: #f1f5f9;
    --surface: rgba(255, 255, 255, 0.9);
    --surface-glass: rgba(255, 255, 255, 0.7);

    /* Text Colors */
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --text-tertiary: #64748b;
    --text-inverse: #ffffff;

    /* Brand Colors - Modern Gradient System */
    --brand-primary: #7c3aed;
    --brand-secondary: #6366f1;
    --brand-tertiary: #8b5cf6;
    --brand-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --brand-gradient-subtle: linear-gradient(135deg, #f0f4ff 0%, #f5f3ff 100%);

    /* Semantic Colors */
    --success: #10b981;
    --success-light: #d1fae5;
    --warning: #f59e0b;
    --warning-light: #fef3c7;
    --error: #ef4444;
    --error-light: #fee2e2;
    --info: #3b82f6;
    --info-light: #dbeafe;

    /* Border & Divider */
    --border: #e2e8f0;
    --border-medium: #cbd5e1;
    --border-strong: #94a3b8;
    --divider: rgba(148, 163, 184, 0.2);

    /* Shadows */
    --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    --shadow-glass: 0 8px 32px 0 rgba(31, 38, 135, 0.15);

    /* Spacing System */
    --space-xs: 0.25rem;
    --space-sm: 0.5rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2rem;
    --space-2xl: 3rem;
    --space-3xl: 4rem;

    /* Border Radius */
    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --radius-2xl: 1.5rem;
    --radius-full: 9999px;

    /* Transitions */
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);

    /* Glass Effect */
    --glass-bg: rgba(255, 255, 255, 0.7);
    --glass-border: rgba(255, 255, 255, 0.18);
    --glass-blur: blur(12px);
  }

  [data-theme="dark"] {
    --bg: #0f172a;
    --bg-secondary: #1e293b;
    --bg-tertiary: #334155;
    --surface: rgba(30, 41, 59, 0.9);
    --surface-glass: rgba(30, 41, 59, 0.7);

    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-tertiary: #94a3b8;
    --text-inverse: #0f172a;

    --border: #334155;
    --border-medium: #475569;
    --border-strong: #64748b;
    --divider: rgba(148, 163, 184, 0.1);

    --glass-bg: rgba(30, 41, 59, 0.7);
    --glass-border: rgba(255, 255, 255, 0.1);
  }
  
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);line-height:1.6;transition:all 0.3s ease;}
  a{color:inherit;text-decoration:none}
  
  /* Icons */
  .icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .icon svg {
    width: 1em;
    height: 1em;
    fill: currentColor;
  }

  /* Theme Toggle */
  .theme-toggle {
    position: fixed;
    top: var(--space-lg);
    right: var(--space-lg);
    background: var(--surface-glass);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-full);
    width: 48px;
    height: 48px;
    color: var(--text-primary);
    cursor: pointer;
    z-index: 1000;
    font-size: 1.25rem;
    transition: all var(--transition-base);
    box-shadow: var(--shadow-md);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .theme-toggle:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: var(--surface);
  }

  /* Hero Section - Modern Glassmorphism */
  .hero-section {
    background: var(--brand-gradient);
    padding: 120px 0 80px 0;
    text-align: center;
    margin-bottom: 60px;
    position: relative;
    overflow: hidden;
  }

  .hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 20% 50%, rgba(124, 58, 237, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(99, 102, 241, 0.15) 0%, transparent 50%);
    pointer-events: none;
  }

  .hero-content {
    position: relative;
    z-index: 1;
  }

  .hero-section h1 {
    font-size: 3.75rem;
    font-weight: 800;
    margin: 0 0 var(--space-lg) 0;
    color: var(--text-inverse);
    line-height: 1.1;
    letter-spacing: -0.02em;
  }

  .hero-section .subtitle {
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: var(--space-2xl);
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
  }

  /* Glass CTA Card */
  .cta-enhanced {
    max-width: 640px;
    margin: 0 auto var(--space-2xl) auto;
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    padding: var(--space-2xl);
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-glass);
    border: 1px solid var(--glass-border);
  }

  .cta-enhanced input {
    width: 100%;
    padding: var(--space-lg) var(--space-xl);
    border: 2px solid var(--border);
    border-radius: var(--radius-xl);
    font-size: 1.125rem;
    margin-bottom: var(--space-md);
    background: var(--bg);
    color: var(--text-primary);
    transition: all var(--transition-base);
  }

  .cta-enhanced input:focus {
    outline: none;
    border-color: var(--brand-primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
  }

  .cta-enhanced button {
    width: 100%;
    background: var(--text-primary);
    color: var(--text-inverse);
    border: none;
    padding: var(--space-lg) var(--space-2xl);
    border-radius: var(--radius-xl);
    font-size: 1.125rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-base);
    box-shadow: var(--shadow-lg);
  }

  .cta-enhanced button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-xl);
    background: var(--text-secondary);
  }

  .cta-enhanced button:active {
    transform: translateY(0);
  }

  /* Trust Signals - Modern Design */
  .trust-signals {
    display: flex;
    justify-content: center;
    gap: var(--space-xl);
    margin-top: var(--space-lg);
    font-size: 0.875rem;
    color: rgba(255, 255, 255, 0.95);
    flex-wrap: wrap;
  }

  .trust-signals span {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    background: rgba(255, 255, 255, 0.15);
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--radius-full);
    backdrop-filter: blur(8px);
  }

  .trust-signals .icon {
    color: var(--success);
    background: var(--bg);
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
  }

  /* Social Proof Section */
  .social-proof {
    max-width: 800px;
    margin: 0 auto;
    padding: var(--space-xl) var(--space-md);
  }

  .social-proof-stats {
    display: flex;
    justify-content: center;
    gap: var(--space-2xl);
    margin-bottom: var(--space-xl);
    flex-wrap: wrap;
  }

  .stat-item {
    text-align: center;
    color: rgba(255, 255, 255, 0.95);
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: 800;
    display: block;
    margin-bottom: var(--space-xs);
  }

  .stat-label {
    font-size: 0.875rem;
    opacity: 0.8;
  }

  /* Email Gate Modal */
  .email-gate-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.8);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: var(--space-lg);
    animation: fadeIn var(--transition-base);
  }

  .email-gate-overlay.active {
    display: flex;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .email-gate-modal {
    background: var(--bg);
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-2xl);
    max-width: 540px;
    width: 100%;
    padding: var(--space-3xl);
    text-align: center;
    animation: slideUp var(--transition-slow);
    border: 1px solid var(--border);
  }

  .email-gate-icon {
    width: 72px;
    height: 72px;
    margin: 0 auto var(--space-lg) auto;
    background: linear-gradient(135deg, var(--success-light), var(--info-light));
    border-radius: var(--radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--success);
  }

  .email-gate-icon svg {
    width: 40px;
    height: 40px;
  }

  .email-gate-title {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: var(--space-sm);
    line-height: 1.2;
  }

  .email-gate-subtitle {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-bottom: var(--space-2xl);
    line-height: 1.6;
  }

  .email-gate-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .email-gate-input {
    width: 100%;
    padding: var(--space-lg) var(--space-xl);
    border: 2px solid var(--border);
    border-radius: var(--radius-xl);
    font-size: 1rem;
    background: var(--bg);
    color: var(--text-primary);
    transition: all var(--transition-base);
  }

  .email-gate-input:focus {
    outline: none;
    border-color: var(--brand-primary);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
  }

  .email-gate-button {
    width: 100%;
    background: var(--brand-gradient);
    color: var(--text-inverse);
    border: none;
    padding: var(--space-lg) var(--space-2xl);
    border-radius: var(--radius-xl);
    font-size: 1.125rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-base);
    box-shadow: var(--shadow-lg);
  }

  .email-gate-button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-xl);
  }

  .email-gate-button:active {
    transform: translateY(0);
  }

  .email-gate-skip {
    margin-top: var(--space-md);
    color: var(--text-tertiary);
    font-size: 0.875rem;
    cursor: pointer;
    transition: color var(--transition-fast);
  }

  .email-gate-skip:hover {
    color: var(--text-secondary);
    text-decoration: underline;
  }

  .email-gate-trust {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);
    margin-top: var(--space-lg);
    color: var(--text-tertiary);
    font-size: 0.8125rem;
  }

  .email-gate-trust svg {
    width: 16px;
    height: 16px;
    color: var(--success);
  }
  
  /* Example Problems - Modern Cards */
  .example-findings {
    margin: var(--space-3xl) 0;
    padding: 0 var(--space-lg);
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
  }

  .example-findings h3 {
    text-align: center;
    font-size: 2rem;
    margin-bottom: var(--space-2xl);
    color: var(--text-primary);
    font-weight: 800;
  }

  .problem-examples {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: var(--space-lg);
  }

  .problem {
    background: var(--bg);
    border: 1px solid var(--border);
    padding: var(--space-xl);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-sm);
    transition: all var(--transition-base);
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .problem::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--error);
    transition: width var(--transition-base);
  }

  .problem:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--border-medium);
  }

  .problem:hover::before {
    width: 8px;
  }

  .problem-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-lg);
    background: var(--error-light);
    color: var(--error);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: var(--space-md);
    font-size: 1.5rem;
  }

  .problem-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--space-sm);
    font-size: 1.125rem;
  }

  .problem-impact {
    color: var(--text-secondary);
    font-size: 0.9375rem;
    line-height: 1.6;
  }
  
  /* Progress Bar */
  .scan-progress{background:white;border:2px solid var(--brand);border-radius:12px;padding:25px;margin:20px auto;max-width:700px;display:none;box-shadow:0 8px 16px rgba(0,0,0,0.1)}
  .scan-progress.active{display:block}
  .progress-header{text-align:center;margin-bottom:20px}
  .progress-header h3{margin:0 0 10px 0;color:#1f2937;font-size:1.5rem}
  
  .main-progress{margin-bottom:25px}
  .progress-bar{height:8px;background:#e5e7eb;border-radius:4px;overflow:hidden;margin-bottom:10px}
  .progress-fill{height:100%;background:linear-gradient(90deg,var(--brand),var(--brand2));transition:width 0.3s ease;width:0%}
  .progress-text{font-size:14px;color:#6b7280;text-align:center}
  
  .scan-steps{margin-top:20px}
  .step{display:flex;align-items:center;padding:12px 0;border-left:3px solid transparent;padding-left:15px;margin-left:10px;border-radius:0 8px 8px 0;transition:all 0.3s ease}
  .step.completed{border-color:#22c55e;background:#f0f9f4}
  .step.active{border-color:#7c3aed;background:#f3f4f6;animation:pulse 2s infinite}
  .step.pending{border-color:#e5e7eb;color:#9ca3af}
  .step-icon{width:20px;height:20px;margin-right:12px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600}
  .step.completed .step-icon{background:#22c55e;color:white}
  .step.active .step-icon{background:#7c3aed;color:white}
  .step.pending .step-icon{background:#e5e7eb;color:#9ca3af}
  .step-text{flex:1}
  .step-duration{font-size:12px;color:#6b7280;margin-top:2px}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
  .live-log{margin-top:20px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;padding:15px;max-height:150px;overflow-y:auto}
  .live-log h4{margin:0 0 10px 0;font-size:14px;color:#374151}
  .log-entry{font-family:monospace;font-size:12px;margin:2px 0;color:#6b7280;padding:2px 0}
  .log-entry.important{color:#7c3aed;font-weight:600}
  
  /* Dashboard Results - Modern Metric Cards */
  .results-dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: var(--space-lg);
    margin: var(--space-xl) 0;
  }

  .metric-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
    text-align: center;
    box-shadow: var(--shadow-sm);
    transition: all var(--transition-base);
    position: relative;
    overflow: hidden;
  }

  .metric-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--border-medium);
  }

  .metric-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    transition: height var(--transition-base);
  }

  .metric-card:hover::before {
    height: 6px;
  }

  .metric-card.critical::before { background: var(--error); }
  .metric-card.warning::before { background: var(--warning); }
  .metric-card.info::before { background: var(--success); }
  .metric-card.money::before { background: linear-gradient(90deg, var(--error), var(--warning)); }

  .metric-icon {
    width: 56px;
    height: 56px;
    margin: 0 auto var(--space-md) auto;
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    position: relative;
  }

  .metric-card.money .metric-icon {
    background: linear-gradient(135deg, var(--error-light), var(--warning-light));
    color: var(--error);
  }

  .metric-card.critical .metric-icon {
    background: var(--error-light);
    color: var(--error);
  }

  .metric-card.warning .metric-icon {
    background: var(--warning-light);
    color: var(--warning);
  }

  .metric-card.info .metric-icon {
    background: var(--success-light);
    color: var(--success);
  }

  .metric-value {
    font-size: 2.25rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: var(--space-xs);
    line-height: 1;
  }

  .metric-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: var(--space-xs);
  }

  .metric-trend {
    font-size: 0.8125rem;
    color: var(--text-tertiary);
    margin-top: var(--space-sm);
  }

  /* Progress Ring for Metrics */
  .progress-ring {
    width: 80px;
    height: 80px;
    margin: 0 auto var(--space-md) auto;
    position: relative;
  }

  .progress-ring svg {
    transform: rotate(-90deg);
  }

  .progress-ring-circle-bg {
    fill: none;
    stroke: var(--border);
    stroke-width: 6;
  }

  .progress-ring-circle {
    fill: none;
    stroke-width: 6;
    stroke-linecap: round;
    transition: stroke-dashoffset var(--transition-slow);
  }

  .progress-ring-value {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--text-primary);
  }
  
  .container{max-width:1200px;margin:0 auto;padding:16px 16px 80px}
  .topbar{position:sticky;top:0;z-index:30;background:var(--bg);border-bottom:1px solid var(--border)}
  .topbar-inner{max-width:1200px;margin:0 auto;display:flex;gap:12px;align-items:center;padding:10px 16px}
  .brand{display:flex;gap:10px;align-items:center;font-weight:700}
  .brand .dot{width:10px;height:10px;border-radius:999px;background:conic-gradient(var(--brand),var(--brand2))}
  .urlfield{flex:1;display:flex;gap:8px}
  .urlfield input{flex:1;background:var(--bg);border:1px solid var(--border);padding:12px 14px;border-radius:10px;color:var(--ink)}
  .btn{background:var(--brand);border:none;color:white;padding:12px 16px;border-radius:10px;font-weight:600;cursor:pointer}
  .btn.alt{background:#e5e7eb;color:#111827}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .toggle{display:flex;gap:6px;border:1px solid var(--border);border-radius:999px;padding:5px;background:#f3f4f6}
  .toggle button{border:none;padding:8px 12px;border-radius:999px;background:transparent;color:var(--ink);cursor:pointer}
  .toggle .active{background:#e5e7eb}
  .progress{height:6px;background:#f3f4f6;border-top:1px solid var(--border)}
  .progress .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand2));transition:width .4s ease}
  .tabs{display:flex;gap:8px;margin:16px 0}
  .tab{padding:10px 14px;border:1px solid var(--border);border-radius:10px;cursor:pointer;background:#f9fafb;color:var(--muted)}
  .tab.active{background:#e5e7eb;color:var(--ink)}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:900px){.grid{grid-template-columns:repeat(12,1fr)}}
  .card{grid-column:span 12;background:var(--bg);border:1px solid var(--border);border-radius:14px;padding:16px}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#f3f4f6;border:1px solid var(--border);font-size:.85rem;color:#374151}
  .pill{padding:7px 10px;border-radius:999px;background:#f9fafb;border:1px solid var(--border);cursor:pointer}
  .pill.active{background:#e5e7eb;color:#111827}
  .kpi{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  @media(min-width:900px){.kpi{grid-template-columns:repeat(4,1fr)}}
  .kpicard{background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:14px}
  .kpicard h3{margin:0 0 4px 0;font-size:.9rem;color:#374151}
  .kpicard .val{font-size:1.6rem;font-weight:800}
  .risk{border-radius:12px;padding:16px;border:1px solid var(--border)}
  .risk.low{background:#d1fae5}
  .risk.med{background:#fef3c7}
  .risk.high{background:#fee2e2}
  .list{display:flex;flex-direction:column;gap:8px}
  .item{background:var(--bg);border:1px solid var(--border);border-radius:12px;overflow:hidden}
  .item header{display:flex;gap:10px;align-items:center;padding:12px 14px;cursor:pointer}
  .item header .title{flex:1;font-weight:600}
  .severity{width:10px;height:10px;border-radius:999px}
  .sev-low{background:var(--ok)} .sev-med{background:var(--warn)} .sev-high{background:var(--bad)}
  .meta{display:flex;gap:8px;flex-wrap:wrap}
  .meta .chip{background:#f3f4f6;border:1px solid var(--border);padding:4px 8px;border-radius:999px;font-size:.8rem;color:#374151}
  .body{display:none;border-top:1px solid var(--border);padding:12px 14px}
  .body.open{display:block}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
  .toolbar input{flex:1;min-width:180px;background:var(--bg);border:1px solid var(--border);padding:10px;border-radius:10px;color:var(--ink)}
  .right{margin-left:auto}
  .ghost{opacity:.65}
  .drawer{position:fixed;top:0;right:-520px;width:520px;max-width:100%;height:100%;background:var(--bg);border-left:1px solid var(--border);
          transition:right .3s ease;z-index:50;display:flex;flex-direction:column;color:#111827}
  .drawer.open{right:0}
  .drawer header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;gap:10px;align-items:center}
  .drawer main{padding:16px;overflow:auto;display:flex;flex-direction:column;gap:12px}
  pre{background:#f9fafb;border:1px solid var(--border);border-radius:10px;padding:10px;overflow:auto;white-space:pre-wrap}
  code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .copy{background:#e5e7eb;border:1px solid var(--border);color:#111827;border-radius:8px;padding:6px 10px;cursor:pointer}
  .empty{padding:18px;border:1px dashed var(--border);border-radius:12px;color:#6b7280;text-align:center}
  .preview{margin-left:8px;font-size:.85rem;color:#7c3aed}
  .banner{margin:12px auto 0;max-width:1200px;background:#e0f2fe;border:1px solid #93c5fd;color:#1e3a8a;padding:10px 14px;border-radius:10px}
  .test{font-size:.85rem;color:#047857}

  /* History & Charts */
  .history-item{background:white;border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px;cursor:pointer;transition:all 0.3s ease}
  .history-item:hover{box-shadow:0 4px 12px rgba(0,0,0,0.1);transform:translateY(-2px)}
  .history-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .history-url{font-weight:600;color:#1f2937}
  .history-score{padding:4px 12px;border-radius:999px;font-weight:600;font-size:0.9rem}
  .score-good{background:#d1fae5;color:#059669}
  .score-medium{background:#fef3c7;color:#d97706}
  .score-bad{background:#fee2e2;color:#dc2626}
  .history-meta{display:flex;gap:12px;align-items:center;font-size:0.85rem;color:#6b7280}
  .history-date{color:#9ca3af}
  .history-actions{margin-left:auto;display:flex;gap:6px}
  .btn-small{padding:6px 12px;border:1px solid var(--border);background:white;border-radius:8px;cursor:pointer;font-size:0.85rem}
  .btn-small:hover{background:#f3f4f6}
  .btn-danger{color:#dc2626;border-color:#dc2626}
  .btn-danger:hover{background:#fee2e2}
  .chart-container{background:white;border:1px solid var(--border);border-radius:12px;padding:20px;height:300px;margin-bottom:20px}
  .stat-card{background:white;border:1px solid var(--border);border-radius:12px;padding:16px;text-align:center}
  .stat-value{font-size:2rem;font-weight:bold;color:#1f2937}
  .stat-label{color:#6b7280;font-size:0.9rem;margin-top:4px}
  #statsOverview{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:20px}
  
  /* Responsive Design */
  @media (max-width: 1024px) {
    .hero-section {
      padding: 80px 0 60px 0;
    }

    .problem-examples {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .results-dashboard {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .hero-section {
      padding: 60px 0 40px 0;
    }

    .hero-section h1 {
      font-size: 2.5rem;
      line-height: 1.2;
    }

    .hero-section .subtitle {
      font-size: 1.125rem;
    }

    .trust-signals {
      flex-direction: column;
      gap: var(--space-sm);
    }

    .social-proof-stats {
      flex-direction: column;
      gap: var(--space-lg);
    }

    .problem-examples {
      grid-template-columns: 1fr;
      gap: var(--space-md);
    }

    .cta-enhanced {
      margin: 0 var(--space-md) var(--space-2xl) var(--space-md);
      padding: var(--space-xl);
    }

    .results-dashboard {
      grid-template-columns: 1fr;
    }

    .metric-card {
      padding: var(--space-lg);
    }

    .theme-toggle {
      width: 44px;
      height: 44px;
    }
  }

  @media (max-width: 480px) {
    .hero-section h1 {
      font-size: 2rem;
    }

    .hero-section .subtitle {
      font-size: 1rem;
    }

    .stat-number {
      font-size: 2rem;
    }

    .metric-value {
      font-size: 1.875rem;
    }

    .problem {
      padding: var(--space-lg);
    }

    .problem-icon {
      width: 40px;
      height: 40px;
    }
  }
</style>
</head>
<body>
  <!-- Email Gate Modal -->
  <div id="emailGateOverlay" class="email-gate-overlay">
    <div class="email-gate-modal">
      <div class="email-gate-icon">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h2 class="email-gate-title">Scan abgeschlossen!</h2>
      <p class="email-gate-subtitle">
        Wir haben Ihre Website analysiert. Geben Sie Ihre E-Mail-Adresse ein, um den vollst√§ndigen Report mit Handlungsempfehlungen zu erhalten.
      </p>
      <form class="email-gate-form" onsubmit="submitEmailGate(event)">
        <input
          type="email"
          id="emailGateInput"
          class="email-gate-input"
          placeholder="ihre@email.de"
          required
          aria-label="E-Mail-Adresse"
        />
        <button type="submit" class="email-gate-button">
          Vollst√§ndigen Report anzeigen
        </button>
      </form>
      <div class="email-gate-skip" onclick="skipEmailGate()">
        √úberspringen und Preview ansehen
      </div>
      <div class="email-gate-trust">
        <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6.5 10.5L4 8L3 9L6.5 12.5L13 6L12 5L6.5 10.5Z" fill="currentColor"/>
        </svg>
        <span>Kein Spam. Nur Ihr Report & hilfreiche Tipps.</span>
      </div>
    </div>
  </div>

  <!-- Theme Toggle -->
  <button class="theme-toggle" onclick="toggleTheme()" title="Theme wechseln" aria-label="Theme wechseln">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M10 15C12.7614 15 15 12.7614 15 10C15 7.23858 12.7614 5 10 5C7.23858 5 5 7.23858 5 10C5 12.7614 7.23858 15 10 15Z" stroke="currentColor" stroke-width="2"/>
      <path d="M10 1V3M10 17V19M19 10H17M3 10H1M16.364 16.364L14.95 14.95M5.05 5.05L3.636 3.636M16.364 3.636L14.95 5.05M5.05 14.95L3.636 16.364" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>

  <!-- Hero Section -->
  <div id="heroSection" class="hero-section">
    <div class="hero-content" style="max-width: 900px; margin: 0 auto; padding: 0 var(--space-lg);">
      <h1>Verlieren Sie ‚Ç¨3.800/Monat durch kaputtes Marketing-Tracking?</h1>
      <p class="subtitle">
        Kostenloser 60-Sekunden-Scan deckt auf, ob Google Ads, Meta Pixel & Co.
        bei Ihnen korrekt funktionieren ‚Äì oder ob Sie t√§glich Werbebudget verschwenden.
      </p>

      <div class="cta-enhanced">
        <input type="url" id="websiteUrl" placeholder="https://ihre-website.de" aria-label="Website URL eingeben">
        <button onclick="startScanFromHero()">Jetzt kostenlos scannen</button>
        <div class="trust-signals">
          <span>
            <span class="icon">‚úì</span>
            2.847 Websites gescannt
          </span>
          <span>
            <span class="icon">‚úì</span>
            √ò ‚Ç¨3.800 Verlust pro Monat entdeckt
          </span>
          <span>
            <span class="icon">‚úì</span>
            Sofort-L√∂sungen inklusive
          </span>
        </div>
      </div>

      <!-- Social Proof Stats -->
      <div class="social-proof">
        <div class="social-proof-stats">
          <div class="stat-item">
            <span class="stat-number">2.847</span>
            <span class="stat-label">Websites gescannt</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">89%</span>
            <span class="stat-label">finden kritische Probleme</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">‚Ç¨3.800</span>
            <span class="stat-label">√ò monatlicher Verlust</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Example Problems -->
  <div id="exampleSection" class="example-findings">
    <h3>Die 3 h√§ufigsten Probleme, die wir finden</h3>
    <div class="problem-examples">
      <div class="problem">
        <div class="problem-icon" aria-hidden="true">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="problem-title">Meta Pixel l√§uft blind ‚Äì Werbebudget verpufft</div>
        <div class="problem-impact">Facebook & Instagram Ads ohne Conversion-Tracking. Sie geben ‚Ç¨850+/Monat aus, aber k√∂nnen den ROI nicht messen.</div>
      </div>

      <div class="problem">
        <div class="problem-icon" aria-hidden="true">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 15V17M6 21H18C19.1046 21 20 20.1046 20 19V13C20 11.8954 19.1046 11 18 11H6C4.89543 11 4 11.8954 4 13V19C4 20.1046 4.89543 21 6 21ZM16 11V7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7V11H16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="problem-title">Consent-Banner ignoriert Nutzer-Wahl</div>
        <div class="problem-impact">Google Analytics & Co. sammeln Daten trotz "Ablehnen". Abmahn-Risiko: bis zu ‚Ç¨20.000 + rechtlich unbrauchbare Daten.</div>
      </div>

      <div class="problem">
        <div class="problem-icon" aria-hidden="true">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13 10V3L4 14H11L11 21L20 10L13 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="problem-title">CSP-Regeln blockieren Marketing-Tools</div>
        <div class="problem-impact">Content Security Policy zu streng eingestellt ‚Äì Retargeting, Heatmaps & A/B-Tests funktionieren nicht. Umsatzverlust: ‚Ç¨1.200+/Monat.</div>
      </div>
    </div>
  </div>

  <!-- Scan Progress -->
  <div class="scan-progress" id="scanProgress">
    <div class="progress-header">
      <h3>Website wird analysiert...</h3>
      <div id="currentUrl" class="badge" style="margin-bottom: 15px;">‚Äì</div>
    </div>
    
    <div class="main-progress">
      <div class="progress-bar">
        <div class="progress-fill" id="mainProgressBar"></div>
      </div>
      <div class="progress-text" id="progressText">Vorbereitung... (0/4 Sessions)</div>
    </div>
    
    <div class="scan-steps">
      <div class="step pending" id="step1">
        <div class="step-icon">1</div>
        <div class="step-text">
          <div><strong>Session 1: Ohne Consent</strong></div>
          <div class="step-duration">Pr√ºft Standard-Verhalten (~25 Sek.)</div>
        </div>
      </div>
      
      <div class="step pending" id="step2">
        <div class="step-icon">2</div>
        <div class="step-text">
          <div><strong>Session 2: Mit Zustimmung</strong></div>
          <div class="step-duration">Simuliert "Alle akzeptieren" (~25 Sek.)</div>
        </div>
      </div>
      
      <div class="step pending" id="step3">
        <div class="step-icon">3</div>
        <div class="step-text">
          <div><strong>Session 3: Ablehnung</strong></div>
          <div class="step-duration">Simuliert "Ablehnen" (~25 Sek.)</div>
        </div>
      </div>
      
      <div class="step pending" id="step4">
        <div class="step-icon">4</div>
        <div class="step-text">
          <div><strong>Analyse & Report</strong></div>
          <div class="step-duration">Vergleicht Ergebnisse (~15 Sek.)</div>
        </div>
      </div>
    </div>
    
    <div class="live-log">
      <h4>üîç Live-Details:</h4>
      <div id="liveLog">
        <div class="log-entry">Scanner wird vorbereitet...</div>
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div id="mainApp" style="display: none;">
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand"><span class="dot"></span>Website Scanner <span class="preview">¬∑ Ergebnisse</span></div>
        <div class="urlfield">
          <input id="url" type="url" placeholder="https://ihre-website.de" />
          <button id="scanBtn" class="btn">Erneut scannen</button>
          <button id="demoBtn" class="btn alt">Demo laden</button>
        </div>
        <div class="toggle" title="Darstellung">
          <button id="modeManager" class="active">Manager</button>
          <button id="modeTech">Tech</button>
        </div>
      </div>
      <div class="progress"><div class="bar" id="bar"></div></div>
    </div>

    <div class="banner" id="banner" style="display:none"></div>

    <div class="container">
      <div class="tabs" id="tabs">
        <button class="tab active" data-tab="summary">Business Impact</button>
        <button class="tab" data-tab="compliance">Compliance</button>
        <button class="tab" data-tab="issues">Probleme & Fixes</button>
        <button class="tab" data-tab="history">Scan-History</button>
        <button class="tab" data-tab="evidence">Technische Details</button>
        <button id="exportPDFBtn" class="btn" style="margin-left:auto">PDF Export</button>
      </div>

      <!-- SUMMARY -->
      <section id="tab-summary" class="grid">
        <div class="card">
          <div class="row" style="justify-content:space-between;gap:12px">
            <div class="row">
              <span class="badge" id="scannedUrl">‚Äì</span>
              <span class="badge" id="timestamp">‚Äì</span>
              <span class="badge" id="version">v‚Äì</span>
            </div>
            <div class="row">
              <span class="badge">3-Session-Test</span>
              <span class="badge">Consent Mode Check</span>
            </div>
          </div>
        </div>

        <!-- Enhanced Dashboard -->
        <div class="results-dashboard">
          <div class="metric-card money">
            <div class="metric-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2V22M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="metric-value" id="monthlyLoss">‚Ç¨0</div>
            <div class="metric-label">Monatlicher Verlust</div>
            <div class="metric-trend" id="monthlyTrend">Durch blockierte Conversions</div>
          </div>
          <div class="metric-card critical">
            <div class="metric-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="metric-value" id="kpiCritical">0</div>
            <div class="metric-label">Kritische Probleme</div>
            <div class="metric-trend">Sofort behebbar</div>
          </div>
          <div class="metric-card warning">
            <div class="metric-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="metric-value" id="kpiPerfect">0</div>
            <div class="metric-label">Compliance: OK</div>
            <div class="metric-trend">DSGVO-konform</div>
          </div>
          <div class="metric-card info">
            <div class="metric-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13 16H12V12H11M12 8H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="metric-value" id="kpiRisk">0</div>
            <div class="metric-label">Compliance: Risiko</div>
            <div class="metric-trend">Rechtliches Risiko</div>
          </div>
        </div>

        <div class="card">
          <div id="riskBox" class="risk ghost"><strong>Risiko-Bewertung</strong><div id="riskText" class="ghost">‚Äì</div></div>
        </div>
      </section>

      <!-- COMPLIANCE -->
      <section id="tab-compliance" class="grid" style="display:none">
        <div class="card">
          <div class="toolbar">
            <span class="pill active" data-cflt="all">Alle</span>
            <span class="pill" data-cflt="perfect">Perfekt</span>
            <span class="pill" data-cflt="good">Eingeschr√§nkt</span>
            <span class="pill" data-cflt="inconsistent">Uneinheitlich</span>
            <span class="pill" data-cflt="bad">Missachtet</span>
            <span class="pill" data-cflt="missing">Fehlt</span>
            <input id="cSearch" placeholder="Suchen (z. B. GA4, Meta, TikTok)"/>
            <div class="right row">
              <button id="expandAllCompliance" class="copy">Alle √∂ffnen</button>
              <button id="collapseAllCompliance" class="copy">Alle schlie√üen</button>
            </div>
          </div>
          <div class="list" id="complianceList"></div>
        </div>
      </section>

      <!-- ISSUES -->
      <section id="tab-issues" class="grid" style="display:none">
        <div class="card">
          <div class="toolbar">
            <span class="pill active" data-iflt="all">Alle</span>
            <span class="pill" data-iflt="critical">Kritisch</span>
            <span class="pill" data-iflt="high">Hoch</span>
            <span class="pill" data-iflt="medium">Mittel</span>
            <span class="pill" data-iflt="low">Niedrig</span>
            <input id="iSearch" placeholder="Filter (Domain, Meldung, Status)"/>
            <div class="right row">
              <span class="badge" id="issueCount">0 Items</span>
            </div>
          </div>
          <div class="list" id="issueList"></div>
        </div>
      </section>

      <!-- HISTORY -->
      <section id="tab-history" class="grid" style="display:none">
        <div class="card">
          <h3 style="margin:0 0 16px 0">Scan-Statistiken</h3>
          <div id="statsOverview"></div>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
            <h3 style="margin:0">Scan-Verlauf</h3>
            <button onclick="loadHistory()" class="copy">üîÑ Aktualisieren</button>
          </div>
          <div id="historyList">
            <div class="empty">Lade History...</div>
          </div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 16px 0">Compliance-√úbersicht</h3>
          <div class="chart-container">
            <canvas id="complianceChart"></canvas>
          </div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 16px 0">Probleme nach Priorit√§t</h3>
          <div class="chart-container">
            <canvas id="issuesChart"></canvas>
          </div>
        </div>
      </section>

      <!-- EVIDENCE -->
      <section id="tab-evidence" class="grid" style="display:none">
        <div class="card">
          <div class="empty">W√§hle in Compliance oder Issues ein Element aus, um technische Details anzuzeigen.</div>
        </div>
      </section>
    </div>
  </div>

  <!-- Evidence Drawer -->
  <aside id="drawer" class="drawer">
    <header>
      <div class="brand"><span class="dot"></span>Technische Details</div>
      <div class="right" style="margin-left:auto"><button id="drawerClose" class="copy">Schlie√üen</button></div>
    </header>
    <main id="drawerBody"></main>
  </aside>

<script>
const CONFIG = {
  mode: 'live',
  features: { modes: true, evidence: true, tests: false, autoDemo: false, copyButtons: true }
};

const scanSteps = [
  { 
    name: 'Session 1: Ohne Consent', 
    duration: 25000, 
    logs: ['üöÄ Browser gestartet (Chromium)', 'üìÑ Seite wird geladen...', 'üç™ Cookie-Banner erkannt', '‚ùå Keine Zustimmung simuliert', 'üîç Netzwerk-Requests √ºberwacht', 'üìä Google Analytics: Keine Daten gesendet', 'üì± Meta Pixel: Blockiert durch CSP', '‚úÖ Session 1 abgeschlossen'] 
  },
  { 
    name: 'Session 2: Mit Zustimmung', 
    duration: 25000, 
    logs: ['üîÑ Neue Browser-Session', '‚úÖ Cookie-Einstellungen: Alle akzeptiert', 'üéØ Consent-Event ausgel√∂st', 'üìä Google Analytics: Daten werden gesendet', 'üì± Meta Pixel: Verbindung hergestellt', 'üéØ Google Ads: Conversion-Tracking aktiv', '‚úÖ Session 2 abgeschlossen'] 
  },
  { 
    name: 'Session 3: Ablehnung', 
    duration: 25000, 
    logs: ['üîÑ Neue Browser-Session', '‚ùå Cookie-Einstellungen: Alle abgelehnt', 'üõë Reject-Event ausgel√∂st', 'üìä Google Analytics: Korrekt gestoppt', 'üì± Meta Pixel: Korrekt gestoppt', 'üõ°Ô∏è Datenschutz-konform', '‚úÖ Session 3 abgeschlossen'] 
  },
  { 
    name: 'Analyse & Report', 
    duration: 15000, 
    logs: ['üî¨ Vergleiche Session-Ergebnisse...', 'üí∞ Budget-Impact berechnet', '‚öñÔ∏è DSGVO-Compliance gepr√ºft', 'üö® Kritische Probleme: 2 gefunden', 'üí° Handlungsempfehlungen generiert', 'üìÑ Report ist fertig!'] 
  }
];

let MODE = 'manager';
let DATA = null;
let currentTheme = localStorage.getItem('theme') || 'light';

// Initialize theme
document.documentElement.setAttribute('data-theme', currentTheme);

// Utility functions
function $(id) { return document.getElementById(id); }
function escapeHtml(s) { return String(s||'').replace(/[&<>\"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;' }[c])); }
function escapeAttr(s) { return escapeHtml(s).replace(/\"/g,'&quot;'); }
function tryHost(u) { try{ return new URL(u).hostname }catch(e){ return u; } }

function showBanner(msg) { 
  const banner = $('banner');
  if(!banner) return; 
  banner.textContent = msg; 
  banner.style.display='block'; 
  setTimeout(()=> banner.style.display='none', 2500); 
}

// Theme Toggle
function toggleTheme() {
  currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', currentTheme);
  localStorage.setItem('theme', currentTheme);

  const toggle = document.querySelector('.theme-toggle');
  if (currentTheme === 'dark') {
    // Moon icon for dark mode
    toggle.innerHTML = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 10.5C16.9 14.64 13.64 18 9.5 18C5.36 18 2 14.64 2 10.5C2 6.36 5.36 3 9.5 3C9.67 3 9.84 3.01 10 3.02C8.9 4.08 8.25 5.54 8.25 7.17C8.25 10.39 10.86 13 14.08 13C15.71 13 17.17 12.35 18.23 11.25C18.16 10.83 18.08 10.66 17 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
  } else {
    // Sun icon for light mode
    toggle.innerHTML = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 15C12.7614 15 15 12.7614 15 10C15 7.23858 12.7614 5 10 5C7.23858 5 5 7.23858 5 10C5 12.7614 7.23858 15 10 15Z" stroke="currentColor" stroke-width="2"/><path d="M10 1V3M10 17V19M19 10H17M3 10H1M16.364 16.364L14.95 14.95M5.05 5.05L3.636 3.636M16.364 3.636L14.95 5.05M5.05 14.95L3.636 16.364" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>';
  }
}

// Progress tracking
function updateDetailedProgress(stepIndex, stepProgress, currentLog) {
  const totalSteps = scanSteps.length;
  const overallProgress = ((stepIndex + stepProgress) / totalSteps) * 100;
  
  const progressBar = $('mainProgressBar');
  if (progressBar) {
    progressBar.style.width = overallProgress + '%';
  }
  
  const progressText = $('progressText');
  if (progressText) {
    const currentStep = scanSteps[stepIndex];
    progressText.innerHTML = '<div><strong>' + currentStep.name + '</strong></div>' +
      '<div style="font-size: 0.9rem; color: #6b7280; margin-top: 4px;">' + (currentLog || 'Wird verarbeitet...') + '</div>' +
      '<div style="font-size: 0.8rem; color: #9ca3af; margin-top: 2px;">Schritt ' + (stepIndex + 1) + ' von ' + totalSteps + ' (' + Math.round(overallProgress) + '%)</div>';
  }
  
  // Update step indicators
  const stepElements = ['step1', 'step2', 'step3', 'step4'];
  stepElements.forEach(function(stepId, index) {
    const element = $(stepId);
    if (!element) return;
    
    if (index < stepIndex) {
      element.className = 'step completed';
      element.querySelector('.step-icon').textContent = '‚úì';
    } else if (index === stepIndex) {
      element.className = 'step active';
      element.querySelector('.step-icon').textContent = index + 1;
    } else {
      element.className = 'step pending';
      element.querySelector('.step-icon').textContent = index + 1;
    }
  });
}

function addLogEntry(text, important) {
  const logDiv = $('liveLog');
  if (!logDiv) return;
  
  const entry = document.createElement('div');
  entry.className = important ? 'log-entry important' : 'log-entry';
  entry.textContent = text;
  logDiv.appendChild(entry);
  logDiv.scrollTop = logDiv.scrollHeight;
  
  // Keep only last 10 entries
  const entries = logDiv.querySelectorAll('.log-entry');
  if (entries.length > 10) {
    entries[0].remove();
  }
}

function sleep(ms) {
  return new Promise(function(resolve) { setTimeout(resolve, ms); });
}

// Email Gate Functions
function showEmailGate() {
  const overlay = $('emailGateOverlay');
  if (overlay) {
    overlay.classList.add('active');
  }
}

function hideEmailGate() {
  const overlay = $('emailGateOverlay');
  if (overlay) {
    overlay.classList.remove('active');
  }
}

function submitEmailGate(event) {
  event.preventDefault();
  const email = $('emailGateInput').value;

  // Save email (you can send to backend here)
  console.log('Email captured:', email);
  localStorage.setItem('userEmail', email);

  // Show success message
  showBanner('‚úì Vielen Dank! Ihr vollst√§ndiger Report wird angezeigt.');

  // Hide gate and show results
  hideEmailGate();
  showResults();
}

function skipEmailGate() {
  // Hide gate and show results
  hideEmailGate();
  showResults();
}

function showResults() {
  $('scanProgress').classList.remove('active');
  $('heroSection').style.display = 'none';
  $('exampleSection').style.display = 'none';
  $('mainApp').style.display = 'block';
  renderAll();
}

// Real scan function with progress
async function startRealScan(url) {
  try {
    addLogEntry('üöÄ Scan wird gestartet...', true);
    
    // Simulate progress for user experience
    for (let stepIndex = 0; stepIndex < scanSteps.length; stepIndex++) {
      const step = scanSteps[stepIndex];
      
      addLogEntry('‚ñ∂Ô∏è Starte: ' + step.name, true);
      
      for (let logIndex = 0; logIndex < step.logs.length; logIndex++) {
        const progress = logIndex / step.logs.length;
        const currentLog = step.logs[logIndex];
        
        updateDetailedProgress(stepIndex, progress, currentLog);
        addLogEntry(currentLog);
        
        await sleep(step.duration / step.logs.length);
      }
      
      await sleep(500);
    }
    
    // Complete progress
    updateDetailedProgress(3, 1, 'Scan abgeschlossen!');
    addLogEntry('üéâ Scan erfolgreich abgeschlossen!', true);
    
    // Try actual scan
    try {
      const response = await fetch('/scan', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url: url })
      });
      
      if (response.ok) {
        const data = await response.json();
        DATA = data;
      } else {
        throw new Error('Server error');
      }
    } catch (e) {
      // Fallback to demo data
      DATA = buildDemoData();
    }
    
    // Show email gate instead of direct results
    $('scanProgress').classList.remove('active');
    showEmailGate();
    
  } catch (error) {
    addLogEntry('‚ùå Fehler: ' + error.message, true);
    // Fallback
    setTimeout(function() {
      DATA = buildDemoData();
      $('scanProgress').classList.remove('active');
      showEmailGate();
    }, 2000);
  }
}

// Start scan from hero
function startScanFromHero() {
  const url = $('websiteUrl').value;
  if (!url) {
    alert('Bitte gib eine Website-URL ein');
    return;
  }
  
  if (!/^https?:\/\//.test(url)) {
    $('websiteUrl').value = 'https://' + url;
  }
  
  // Hide hero, show progress
  $('heroSection').style.display = 'none';
  $('exampleSection').style.display = 'none';
  $('urgencyBanner').style.display = 'none';
  $('scanProgress').classList.add('active');
  
  // Update URL display
  $('currentUrl').textContent = $('websiteUrl').value;
  
  // Start the actual scan
  startRealScan($('websiteUrl').value);
}

// DEMO DATA
function buildDemoData() {
  const now = new Date().toLocaleString('de-DE');
  return {
    version: '2.4.0',
    scannedUrl: 'https://demo.regukit.de',
    timestamp: now,
    summary: {
      totalIssues: 7,
      highPriorityIssues: 2,
      marketingTags: [
        { name:'Google Analytics 4', property:'hasGA4', compliance:'perfect', impact:'‚úÖ GA4 respektiert die Einwilligung.', gdprRisk:'none', withoutConsent:false, withAccept:true, withReject:false, businessImpact:'Besucherdaten DSGVO-konform.' },
        { name:'Meta Pixel (Facebook/Instagram)', property:'hasMetaPixel', compliance:'inconsistent', impact:'ü§î Uneinheitliches Verhalten, teils CSP-Blockaden.', gdprRisk:'medium', withoutConsent:false, withAccept:true, withReject:false, businessImpact:'Social ROI nur teilweise messbar.' },
        { name:'Google Tag Manager', property:'hasGTM', compliance:'perfect', impact:'‚úÖ Consent default denied vorhanden.', gdprRisk:'none', withoutConsent:true, withAccept:true, withReject:true, businessImpact:'Steuert Tags korrekt nach Einwilligung.' },
        { name:'TikTok Pixel', property:'hasTikTokPixel', compliance:'missing', impact:'‚ùå Eingebunden, aber keine Daten√ºbertragungen erkannt.', gdprRisk:'none', withoutConsent:false, withAccept:false, withReject:false, businessImpact:'TikTok-Kampagnen nicht messbar.' }
      ]
    },
    details: {
      errors: [
        { type:'Console Error', message:'Content Security Policy blocked Facebook', priority:'high', translation:'Sicherheits¬≠einstellungen blockieren Verbindungen.', techFix:'CSP connect-src um connect.facebook.net erweitern.' }
      ],
      networkIssues: [
        { url:'https://www.facebook.com/tr/?id=12345', method:'GET', resourceType:'fetch', status:0, priority:'high', translation:'Meta Pixel ‚Äì Social ROI unbekannt.', techFix:'CSP/CORS pr√ºfen' }
      ],
      cspViolations: [
        { message:'connect-src blocked https://www.facebook.com/tr/?id=12345', priority:'high', techFix:'connect-src https://www.facebook.com zulassen' }
      ]
    },
    evidence: {
      evidence: {
        hasGA4: { nonTechMeaning: 'Misst Besucher ohne Einwilligung zu verletzen.', nonTechFix: 'Consent Mode aktivieren.' },
        hasMetaPixel: { nonTechMeaning: 'Facebook/Instagram Kampagnen messen.', nonTechFix: 'Pixel nur nach Einwilligung ausl√∂sen.' }
      }
    }
  };
}

// Render functions
function renderSummary() {
  if (!DATA) return;
  $('scannedUrl').textContent = DATA.scannedUrl || '‚Äì';
  $('timestamp').textContent = DATA.timestamp || '‚Äì';
  $('version').textContent = 'v' + (DATA.version || '‚Äì');
  
  const total = (DATA.details?.errors?.length || 0) + (DATA.details?.networkIssues?.length || 0) + (DATA.details?.cspViolations?.length || 0);
  const crit = (DATA.details?.errors || []).filter(function(e) { return /critical|high/i.test(e.priority || ''); }).length;
  const mtags = DATA.summary?.marketingTags || [];
  const perfect = mtags.filter(function(m) { return m.compliance === 'perfect'; }).length;
  const risk = mtags.filter(function(m) { return ['bad','inconsistent','good','missing'].includes(m.compliance); }).length;
  
  // Calculate money impact
  let monthlyLoss = 0;
  if (crit > 0) monthlyLoss += 650; // Facebook issues
  if (total > 3) monthlyLoss += 400; // GA issues
  if (risk > 2) monthlyLoss += 300; // Additional compliance issues
  
  $('monthlyLoss').textContent = '‚Ç¨' + monthlyLoss.toLocaleString();
  $('kpiCritical').textContent = crit; 
  $('kpiPerfect').textContent = perfect; 
  $('kpiRisk').textContent = risk;
  
  const riskBox = $('riskBox');
  const riskText = $('riskText');
  let level = 'low';
  let text = 'Niedriges Risiko ‚Äì keine kritischen Befunde';
  
  if (crit > 0) { 
    level = 'high'; 
    text = 'Hohes Risiko ‚Äì kritische Probleme gefunden.'; 
  } else if (total > 0) { 
    level = 'med'; 
    text = 'Mittleres Risiko ‚Äì einige Probleme erfordern Aufmerksamkeit.'; 
  }
  
  riskBox.className = 'risk ' + level; 
  riskText.textContent = text; 
  riskBox.classList.remove('ghost'); 
  riskText.classList.remove('ghost');
}

function renderAll() { 
  if (!DATA) return; 
  renderSummary(); 
  // Add other render functions here as needed
}

// Event handlers
document.addEventListener('DOMContentLoaded', function() {
  // Hero input enter key
  const websiteUrl = $('websiteUrl');
  if (websiteUrl) {
    websiteUrl.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        startScanFromHero();
      }
    });
  }

  // Demo button
  const demoBtn = $('demoBtn');
  if (demoBtn) {
    demoBtn.addEventListener('click', function() {
      DATA = buildDemoData();
      renderAll();
      showBanner('Demo-Daten geladen.');
    });
  }

  // Scan button
  const scanBtn = $('scanBtn');
  if (scanBtn) {
    scanBtn.addEventListener('click', function() {
      const url = $('url').value.trim();
      if (url) {
        startRealScan(url);
      } else {
        showBanner('‚ùå Bitte URL eingeben');
      }
    });
  }

  // Tab switching
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('tab')) {
      // Remove active from all tabs
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.grid section').forEach(section => section.style.display = 'none');
      
      // Activate clicked tab
      e.target.classList.add('active');
      const tabId = e.target.getAttribute('data-tab');
      const section = document.getElementById('tab-' + tabId);
      if (section) {
        section.style.display = 'block';
      }
    }
  });

  // Mode toggle
  const modeManager = $('modeManager');
  const modeTech = $('modeTech');
  
  if (modeManager) {
    modeManager.addEventListener('click', function() {
      MODE = 'manager';
      modeManager.classList.add('active');
      if (modeTech) modeTech.classList.remove('active');
    });
  }
  
  if (modeTech) {
    modeTech.addEventListener('click', function() {
      MODE = 'tech';
      modeTech.classList.add('active');
      if (modeManager) modeManager.classList.remove('active');
    });
  }

  // Focus URL input
  setTimeout(function() {
    if (websiteUrl) websiteUrl.focus();
  }, 300);

  // Initialize theme toggle with SVG icon
  const themeToggle = document.querySelector('.theme-toggle');
  if (themeToggle) {
    if (currentTheme === 'dark') {
      themeToggle.innerHTML = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 10.5C16.9 14.64 13.64 18 9.5 18C5.36 18 2 14.64 2 10.5C2 6.36 5.36 3 9.5 3C9.67 3 9.84 3.01 10 3.02C8.9 4.08 8.25 5.54 8.25 7.17C8.25 10.39 10.86 13 14.08 13C15.71 13 17.17 12.35 18.23 11.25C18.16 10.83 18.08 10.66 17 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    } else {
      themeToggle.innerHTML = '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 15C12.7614 15 15 12.7614 15 10C15 7.23858 12.7614 5 10 5C7.23858 5 5 7.23858 5 10C5 12.7614 7.23858 15 10 15Z" stroke="currentColor" stroke-width="2"/><path d="M10 1V3M10 17V19M19 10H17M3 10H1M16.364 16.364L14.95 14.95M5.05 5.05L3.636 3.636M16.364 3.636L14.95 5.05M5.05 14.95L3.636 16.364" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>';
    }
  }
});
</script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<!-- Enhanced Dashboard Features -->
<script src="/dashboard.js"></script>

</body>
</html>
